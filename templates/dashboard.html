{% extends "base.html" %}
{% block content %}
    <h2>Dashboard - {{ today.strftime('%A, %B %d, %Y') }}</h2>
    
    <div style="margin-bottom: 20px; display: flex; gap: 10px;">
        <form action="{{ url_for('generate_schedule') }}" method="POST">
            <button type="submit">ğŸ“… Generate Schedule</button>
        </form>
        <button onclick="window.location.href='{{ url_for('export_csv') }}'">ğŸ“¤ Export CSV</button>
        <button onclick="window.location.href='{{ url_for('view_history') }}'">ğŸ“Š View History</button>
    </div>

    <h3>Today's Schedule</h3>
    {% if schedules %}
        {% for schedule in schedules %}
            <div class="task schedule">
                {% if schedule.regularTasks %}
                    <strong>{{ schedule.regularTasks.name if schedule.regularTasks.name else 'Unknown Task' }}</strong><br>
                    ğŸ• {{ schedule.start_time }} - {{ schedule.end_time }}<br>
                    Length: {{ schedule.regularTasks.length }} hours
                {% else %}
                    <strong>{{ schedule.tasks.name if schedule.tasks.name else 'Unknown Task' }}</strong><br>
                    ğŸ• {{ schedule.start_time }} - {{ schedule.end_time }}<br>
                    Priority: {{ schedule.tasks.priority if schedule.tasks.priority else 'N/A' }}
                    {% if schedule.schedule_id not in session.get('completed_tasks', []) %}

                        <form action="{{ url_for('complete_task', schedule_id=schedule.schedule_id) }}" 
                            method="POST" style="display:inline; margin-left: 10px;">
                            <button type="submit" style="background: #4CAF50;">âœ“ Complete</button>
                        </form>
                    {% else %}
                        <span style="color: #81c784; font-weight: bold; margin-left: 10px;">âœ” Completed</span>
                    {% endif %}
                    

                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p>No schedule yet. Click "Generate Schedule" to create one.</p>
    {% endif %}

    <h3>Your Tasks</h3>
    {% if tasks %}
        {% for task in tasks %}
            <div class="task 
                {% if task.priority > 7 %}priority-high
                {% elif task.priority > 4 %}priority-medium
                {% else %}priority-low{% endif %}">
                <strong>{{ task.name }}</strong><br>
                Effort: {{ task.effort }}/10 | Urgency: {{ task.urgency }}/10 | Duration: {{ task.length }}h<br>
                Priority Score: {{ task.priority }}
                <button type="button" onclick="window.open('{{ url_for('adjust_task_popup', task_id=task.task_id) }}', 'popup', 'width=400,height=500')" 
                    style="background: #0c4b82; margin-right: 10px;">
                    Adjust
                </button>
                
                <form action="{{ url_for('delete_task', task_id=task.task_id) }}" method="POST" style="display:inline;">
                    <button type="submit" style="background: #f44336; margin-left: 10px;">Delete</button>
                </form>


                
            </div>
        {% endfor %}
    {% else %}
        <p>No tasks yet. <a href="{{ url_for('create_task') }}">Create your first task</a></p>
    {% endif %}

    <h3>Your Regular Tasks</h3>
    {% if regular_tasks %}
        {% for reg_task in regular_tasks %}
            <div class="task">
                <strong>{{ reg_task.name }}</strong><br>
                Duration: {{ reg_task.length }}h<br>
                
                <form action="{{ url_for('delete_task', task_id=reg_task.regularTaskId) }}" method="POST" style="display:inline;">
                    <button type="submit" style="background: #f44336; margin-left: 10px;">Delete</button>
                </form>
            </div>
        {% endfor %}
    {% else %}
        <p>No regular tasks yet. <a href="{{ url_for('create_task') }}">Create your first regular task</a></p>
    {% endif %}
{% endblock %}